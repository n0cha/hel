<head>
	<title>HEL</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

</body>

<template name="layout">
	<div id="header">
		<h1>Hilversum Escalation League</h1>
		<h4>A Warhammer Fantasy Battles Campaign</h4>
		{{> loginButtons}}
		{{> menu}}
		<div class="pusher"></div>
	</div>
	<div id="content">
		{{> yield}}
	</div>
</template>

<template name="menu">
	<ul id="menu">
		{{#each menuItems}}
		<li class="{{selected}}"><a id="{{name}}" href="/{{name}}">{{title}}</a></li>
		{{/each}}
	</ul>
</template>

<template name="home">
	<p>Welcome to the website for the Hilversum Escalation League.</p>

	<p>This is a meta-game around Warhammer, intended to provide the battles with context, fluff and a Greater
		Goal.</p>

	<h2>Rules of the Game</h2>

	<p>Players can subscribe through this website. Each player picks an army book, which they will be using throughout
		the campaign.</p>

	<p>The campaign happens on the map of the realm, consisting of regions. Each player will get 5 adjacent regions
		assigned to them randomly at the start of the game.</p>

	<p>Once all players have subscribed, the game starts. The game consists of 5 rounds.</p>

	<p>Each round, you start by submitting an army list that you will be using that round. The point allowance for the
		army list increases each round, by increments of 500 points. So, the first round will see 500pts armies, the second
		round 1000pts, and so on up to 2500pts for the 5th round. Your army list will be invisible to the other players
		until everyone has submitted their list and declared an attack.</p>

	<p>You can also include a complementary Mercenary Force of up to 20% of the points allowance for that round. This
		force can consist of units from any army, but must all be from the same army. See <a href="#Bonuses">Bonuses</a> below for more
		about this.</p>

	<p>After you have submitted an army list, you can declare your attack for that round. You do this by going to the game page and selecting an
		enemy region on the map which is adjacent to one of your own regions.</p>

	<p>Once all players have done this, the game page will show all the battles that need to be fought. In effect, each
		player will fight one offensive battle each round and any number of defensive battles. You can make up your
		own fluff for how it is possible that the same army can be fighting in multiple places at the same time. I don't
		know, portals or something.</p>

	<p>After a battle has been fought, the result can be submitted to the website. After all battles are fought, the next
		round starts.</p>

	<h2>Winning</h2>

	<p>The winner of the campaign is the player who controls the most regions at the end of round 5.</p>

	<h2 id="Bonuses">Bonuses</h2>
	<dl>
		<dt>Underdog Support</dt>
		<dd>At the start of a round, if you control less regions than your opponent for a certain battle, you are entitled
			to deploy your Mercenary Force for that battle. The game page will indicate this.
		</dd>
		<dt>Awe-inspiring Splendor</dt>
		<dd>If your entire fielded army (including mercenaries if deployed) is painted, you gain a Victory Point bonus of
			10% of the point allowance for that battle.
		</dd>
	</dl>
	
	<p>For any comments, questions or suggestions, <a href="mailto:hel@richardheuser.nl">e-mail me</a>.</p>
</template>

<!-- http://www.gameempire.com/forum/index.php?/topic/6638-the-changes-to-magic-in-the-end-times/page__st__20#entry41175 -->

<template name="armies">
	{{#if currentUser}}
		{{> round}}
		{{> allArmies}}
		{{#if gameStarted}}
		{{else}}
			{{> armySettings}}
		{{/if}}
		{{#if army}}
			{{> armyList}}
		{{/if}}
	{{else}}
		<p>You need to be signed in to view this page.</p>
	{{/if}}
</template>

<template name="allArmies">
	<section>
		<h3>Armies</h3>
		<table class="armies">
			<tbody>
			{{#each players}}
			<tr class="{{me}}">
				<td style="background-color: {{color}};"></td>
				<td><img class="smallIcon" src="{{icon}}" /></td>
				<td>{{armyName}}</td>
				<td>({{army}})</td>
				<td>{{regions}} regions</td>
				{{#if started}}
					<td><a id="showList" href="#">Show Army List</a></td>
				{{/if}}
			</tr>
			{{/each}}
			</tbody>
		</table>
	</section>
</template>

<template name="armySettings">
	<section>
		<h3>Your Army</h3>
		{{#if player}}
			<h4>Note: This can no longer be changed once the game is underway!</h4>
			<div>
				<label>Army book:</label>
				<select id="army">
					<option value="">[select your army]</option>
					{{#each armies}}
					<option value="{{name}}" {{selected}}>{{name}}</option>
					{{/each}}
				</select>
			</div>
			<div>
				<label>Army name:</label>
				<input id="armyName" value="{{armyName}}">
			</div>
			<div>
				<label>Color:</label>
				<input id="colorPicker" type="color" value="{{color}}" />
			</div>
			<div>
				<label>Icon:</label>
				<div id="dropzone">DRAG HERE
					{{#if icon}}
					<img id="icon" src="{{icon}}" />
					{{/if}}
				</div>
				<!--<input id="upload" type="file" />-->
			</div>
		{{else}}
			<button id="createPlayer">Create Army</button>
		{{/if}}
	</section>
</template>

<template name="armyList">
	<section>
		<h3>Your Army List</h3>
		{{#if roundPrep}}
			<div>
				<textarea id="armyList">{{armyList}}</textarea>
			</div>
			<div>
				<button id="submitArmyList">Submit</button>
			</div>
		{{else}}
			<div class="armyList">{{armyList}}</div>
		{{/if}}
	</section>
</template>

<template name="game">
	{{#if currentUser}}
		{{> round}}
		{{#if roundStarted}}
			{{> battles}}
		{{/if}}
		{{#if gameStarted}}
			{{> map}}
		{{/if}}
	{{else}}
		<p>You need to be signed in to view this page.</p>
	{{/if}}
</template>

<template name="round">
	<section id="round">
		<h3>Round {{number}}</h3>
		<h4>Point Allowance: {{points}}</h4>
		<h4>
			{{#if started}}
			Round has started - Fight your battles!
			{{else}}
			Preparation Phase - {{todo}}
			{{/if}}
		</h4>
		{{#if number}}
			<!--<button id="resetGame">Reset Game</button>-->
			{{#if done}}
				{{#if started}}
					{{#if done}}
						<button id="nextRound">Next Round</button>
					{{/if}}
				{{else}}
					<button id="startRound">Start Round</button>
				{{/if}}
			{{else}}
				{{ > waiting}}
			{{/if}}
		{{else}}
			<button id="startGame">Start Game</button>
		{{/if}}
	</section>
</template>

<template name="map">
	<section>
		<h3>The Realm</h3>
		<div id="mapContainer" style="width:{{width}}px;height:{{height}}px;"><div id="mapBox">
			<svg id="map" width="{{width}}" height="{{height}}">
				{{#each region}}
					<g transform="translate({{anchorX}} {{anchorY}})">
					<polygon class="region" points="{{points}}" fill="{{color}}" data-id="{{id}}" data-owned="{{owned}}" data-attacking="{{attacking}}">
						{{#if attacking}}
						<animate id="animation1"
										 attributeName="fill-opacity"
										 from="0.5" to="0.25" dur="1s"
										 begin="0s;animation2.end" />
						<animate id="animation2"
										 attributeName="fill-opacity"
										 from="0.25" to="0.5" dur="1s"
										 begin="animation1.end" />
						<animate id="animation3"
										 attributeName="stroke"
										 from="red" to="pink" dur="1s"
										 begin="0s;animation4.end" />
						<animate id="animation4"
										 attributeName="stroke"
										 from="pink" to="red" dur="1s"
										 begin="animation1.end" />
						{{/if}}
					</polygon>
					<!--<text x="15" y="30">{{x}},{{y}}</text>-->
					{{#if capital}}
						<image x="14" y="14" width="32" height="32" xlink:href="{{capital}}" />
					{{/if}}
					</g>
				{{/each}}
			</svg>
		</div></div>
		{{#if attackRegion}}
			<div id="attack">
				Attacking: <span class="attackRegion">{{attackRegion}}</span>, owned by: <span class="defenderName" style="color:{{defenderColor}};">{{defenderName}}</span> <span class="defenderArmy">({{defenderArmy}})</span>
			</div>
		{{/if}}
	</section>
</template>

<template name="battles">
	<section>
		<h3>Battles</h3>
	<table class="battles">
		<tbody>
			{{#each battles}}
				<tr>
					<th colspan="4">Battle of {{region}}</th>
					<td colspan="2">
						{{#if winnerIsMe}}
							<button id="didntWin">No I didn't. :)</button>
						{{else}}
							{{#if iCanWin}}
								<button id="iWon">I won!</button>
							{{/if}}
						{{/if}}
					</td>
				</tr>
				{{#each players}}
					<tr class="{{me}} {{isWinner}}">
						<td>{{role}}</td>
						<td style="background-color: {{color}};"></td>
						<td>{{armyName}}</td>
						<td>({{army}})</td>
						<td>{{userName}}</td>
						<td>{{#if underdog}}Underdog Support{{/if}}</td>
					</tr>
				{{/each}}
			{{/each}}
		</tbody>
	</table>
	</section>
</template>

<template name="waiting">
	<h4 id="waiting">Waiting for: {{#each playersNotDone}}<span>{{userName}}</span>{{/each}}</h4>
</template>
